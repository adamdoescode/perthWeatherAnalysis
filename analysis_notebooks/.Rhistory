dark_theme_bw() +
geom_smooth(method="lm")
daysOver35 <- NOAA_data %>%
filter(Year > 1944) %>%
#drop empty TMAX cols
drop_na(TMAX) %>%
group_by(Year) %>%
count(daysOver35 = TMAX > 35) %>%
#pivot wider so that under and over 35 on the same row
pivot_wider(id_cols=Year, names_from = daysOver35, values_from = n) %>%
#rename new cols to informative names
rename("under35" = "FALSE", "over35" = "TRUE") %>%
#where over35 is NaN there are no days over 35
mutate(over35 = replace_na(over35, 0)) %>%
#get proportion
mutate(proportion_over35 = over35/(under35 + over35))
daysOver35 %>%  ggplot(aes(Year, proportion_over35)) +
geom_point() +
geom_smooth(method="lm") +
dark_theme_bw() +
ggtitle("Proportion of days over 35C each year at Perth Airport") +
ylab("Proportion of days over 35C")
#run a simple lm for this
broom::tidy(summary(lm(proportion_over35 ~ Year, data = daysOver35)))
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate daysNoRain
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysUnder35 = TMAX < 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysUnder35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data
NOAA_data %>%
select(Month, TMAX, streakDaysOver35, daysUnder35)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysUnder35 = TMAX < 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysUnder35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
drop_na()
select(Month, TMAX, streakDaysOver35, daysUnder35)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysUnder35 = TMAX < 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysUnder35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
drop_na() %>%
select(Month, TMAX, streakDaysOver35, daysUnder35)
NOAA_data %>%
drop_na() %>%
select(Month, TMAX, streakDaysOver35, daysUnder35)
NOAA_data %>%
drop_na(TMAX) %>%
select(Month, TMAX, streakDaysOver35, daysUnder35)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysUnder35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysUnder35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
drop_na(TMAX) %>%
select(Month, TMAX, streakDaysOver35, daysUnder35)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
drop_na(TMAX) %>%
select(Month, TMAX, streakDaysOver35, daysUnder35)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
drop_na(TMAX) %>%
select(Month, TMAX, streakDaysOver35, daysOver35)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(Month, TMAX, streakDaysOver35, daysOver35)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35)
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
daysOver35 = max(daysOver35),
)
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
daysOver35 = max(daysOver35),
)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(daysOver35),
)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(daysOver35),
)
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35)
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35)
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(daysOver35),
)
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
)
#format a table to have each streak of days over 35 with relevant stats
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
) %>%
ggplot(aes(startYear, maxDaysOver35)) +
geom_point() +
dark_theme_bw()
#format a table to have each streak of days over 35 with relevant stats
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
)
#format a table to have each streak of days over 35 with relevant stats
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
) %>%
group_by(startYear) %>%
summarise(meanStreakLength = mean(maxDaysOver35))
#format a table to have each streak of days over 35 with relevant stats
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
) %>%
#get mean streak days for each start year
group_by(startYear) %>%
summarise(meanStreakLength = mean(maxDaysOver35)) %>%
ggplot(aes(startYear, meanStreakLength)) +
geom_point() +
dark_theme_bw()
#format a table to have each streak of days over 35 with relevant stats
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
) %>%
#get mean streak days for each start year
group_by(startYear) %>%
summarise(meanStreakLength = mean(maxDaysOver35)) %>%
ggplot(aes(startYear, meanStreakLength)) +
geom_point() +
geom_smooth(method="lm")
#format a table to have each streak of days over 35 with relevant stats
NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
) %>%
#get mean streak days for each start year
group_by(startYear) %>%
summarise(meanStreakLength = mean(maxDaysOver35)) %>%
ggplot(aes(startYear, meanStreakLength)) +
geom_point() +
geom_smooth(method="lm") +
dark_theme_bw()
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
#format a table to have each streak of days over 35 with relevant stats
meanStreakOver35_year <- NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
) %>%
#get mean streak days for each start year
group_by(startYear) %>%
summarise(meanStreakLength = mean(maxDaysOver35))
meanStreakOver35_year %>%
ggplot(aes(startYear, meanStreakLength)) +
geom_point() +
geom_smooth(method="lm") +
dark_theme_bw()
meanStreakOver35_year %>%
ggplot(aes(startYear, meanStreakLength)) +
geom_point() +
geom_smooth(method="lm") +
dark_theme_bw() +
ggtitle("mean number of days over 35 in a row each year at Perth Airport") +
ylab("mean number of days over 35") +
xlab("Year streak started")
broom::tidy(summary(lm(meanStreakLength ~ startYear, data = meanStreakOver35_year)))
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
#format a table to have each streak of days over 35 with relevant stats
meanStreakOver35_year <- NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
) %>%
#get mean streak days for each start year
group_by(startYear) %>%
summarise(meanStreakLength = mean(maxDaysOver35))
meanStreakOver35_year %>%
ggplot(aes(startYear, meanStreakLength)) +
geom_point() +
geom_smooth(method="lm") +
dark_theme_bw() +
ggtitle("mean number of days over 35 in a row each year at Perth Airport") +
ylab("mean number of days over 35") +
xlab("Year streak started")
broom::tidy(summary(lm(meanStreakLength ~ startYear, data = meanStreakOver35_year)))
#get streaks of days over 35C
NOAA_data <- NOAA_data %>%
mutate(daysOver35 = TMAX > 35) %>%
#we use data.table::rleid to get group IDs for each streak
group_by(IDstreakDaysOver35 = rleid(daysOver35)) %>%
#we use dplyr::mutate and base::ifelse to calculate streakDaysOver35
mutate(streakDaysOver35 = ifelse(daysOver35, row_number(), row_number()-1))
#format a table to have each streak of days over 35 with relevant stats
meanStreakOver35_year <- NOAA_data %>%
filter(daysOver35) %>%
drop_na(TMAX) %>%
select(DATE, Month, Year, TMAX, streakDaysOver35, daysOver35) %>%
group_by(IDstreakDaysOver35) %>%
summarise(
startDate = min(DATE),
startYear = min(Year),
startMonth = min(Month),
maxDaysOver35 = max(streakDaysOver35),
) %>%
#get mean streak days for each start year
group_by(startYear) %>%
summarise(meanStreakLength = mean(maxDaysOver35))
meanStreakOver35_year %>%
ggplot(aes(startYear, meanStreakLength)) +
geom_point() +
geom_smooth(method="lm") +
dark_theme_bw() +
ggtitle("mean number of days over 35 in a row each year at Perth Airport") +
ylab("mean number of days over 35") +
xlab("Year streak started")
broom::tidy(summary(lm(meanStreakLength ~ startYear, data = meanStreakOver35_year)))
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
suppressMessages(library(data.table))
suppressMessages(library(tidyverse))
suppressMessages(library(ggdark))
suppressMessages(library(patchwork))
suppressMessages(library(weathermetrics))
PER_airport <- fread("../data/3184544.csv")
#filter for usability
#turns out the data attributes are useless lol
PER_airport <- PER_airport %>% select(!ends_with("_ATTRIBUTES"))
NOAA_other_stations_1_freedomUnits <- fread("../data/3186152.csv")
NOAA_other_stations_1 <- NOAA_other_stations_1_freedomUnits %>%
#drop extra cols
select(!c("DAPR","DATN","DATX","DWPR","MDPR","MDTN","MDTX","TAVG")) %>%
mutate(
PRCP = PRCP*25.4,
TMAX = fahrenheit.to.celsius(TMAX),
TMIN = fahrenheit.to.celsius(TMIN)
)
NOAA_other_stations_2 <- fread("../data/3186197.csv") %>%
select(!c("DAPR","DATN","DATX","DWPR","MDPR","MDTN","MDTX"))
NOAA_other_stations_all <- rbind(NOAA_other_stations_1,NOAA_other_stations_2)
PER_airport <- PER_airport %>% select(!c("TAVG","SNWD"))
NOAA_other_stations_all <- rbind(NOAA_other_stations_all, PER_airport)
NOAA_other_stations_all <- NOAA_other_stations_all %>%
mutate(
Year = format(DATE, "%Y") %>% as.numeric(),
Month = month(DATE),
Day = format(DATE, "%d") %>% as.numeric(),
#bool for any rain
did_rain = PRCP > 0,
Month_name = month.name[Month] %>% fct_relevel(month.name)
)
NOAA_other_stations_all %>%
group_by(NAME) %>%
summarise(
mean_rainfall = mean(PRCP, na.rm = T),
mean_TMIN = mean(TMIN, na.rm = T),
mean_TMAX = mean(TMAX, na.rm = T),
)
NOAA_other_stations_all %>% summary
dates_covered_by_stations <- NOAA_other_stations_all %>%
group_by(NAME) %>%
summarise(
minDate = min(DATE),
maxDate = max(DATE),
)
dates_covered <- dates_covered_by_stations %>%
ggplot(aes(NAME, ymin=minDate, ymax=maxDate)) +
geom_linerange() +
dark_theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1)) +
xlab("Station Name") + ylab("Date range (Years)") +
ggtitle("Date range available for each station")
dates_covered_by_variable <- NOAA_other_stations_all %>%
pivot_longer(c(TMAX,TMIN,PRCP), names_to = "measurement") %>%
# filter(NAME == "ROTTNEST ISLAND LIGHTHOUSE, AS") %>%
ggplot(aes(measurement, DATE, colour=!is.na(value))) +
geom_point() +
dark_theme_bw() +
facet_wrap(vars(NAME)) +
ggtitle("Dates where values are available for each station")
dates_covered + dates_covered_by_variable
yearly_statistics <- NOAA_other_stations_all %>%
group_by(NAME, Year) %>%
summarise(
meanRainfall = mean(PRCP, na.rm = T),
totalRainfall = sum(PRCP, na.rm = T),
meanMaximumTemperature = mean(TMAX),
meanMinimumTemperature = mean(TMIN),
)
yearly_statistics %>%
ggplot(aes(Year, totalRainfall, colour = NAME)) +
geom_point(alpha=0.5) +
geom_smooth(method="lm", se = F) +
dark_theme_bw()
yearly_statistics %>%
filter(str_detect(NAME, "ROTTNEST")) %>%
ggplot(aes(Year, totalRainfall, colour = NAME)) +
geom_point(alpha=0.5) +
geom_smooth(method="lm", se = F) +
dark_theme_bw() +
ggtitle("total rainfall each year for Rottnest Island from both stations")
Rotto_yearly_statistics <- NOAA_other_stations_all %>%
group_by(NAME, Year) %>%
summarise(
totalRainfall = sum(PRCP, na.rm = F),
naRainfallCount = sum(is.na(PRCP)),
) %>%
filter(str_detect(NAME, "ROTTNEST"), Year >= 1907)
Rotto_yearly_statistics_fewNa <- Rotto_yearly_statistics %>%
filter(naRainfallCount < 10)
Rotto_yearly_statistics %>%
ggplot(aes(Year, totalRainfall, colour=naRainfallCount)) +
geom_point() +
# geom_smooth(method="lm") +
dark_theme_bw()
Rotto_yearly_statistics %>%
ggplot(aes(Year, totalRainfall, colour = NAME)) +
geom_point(alpha=0.5) +
geom_smooth(method="lm", se = F) +
dark_theme_bw() +
ggtitle("total rainfall each year for Rottnest Island from both stations")
model_rotto_rainfall_1 <- lm(totalRainfall ~ Year * NAME, data=Rotto_yearly_statistics_fewNa)
summary(model_rotto_rainfall_1)
